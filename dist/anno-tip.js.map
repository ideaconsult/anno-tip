{"version":3,"file":"anno-tip.js.map","sources":["../src/TextSelection.js","../src/AnnoTip.js"],"sourcesContent":["\"use strict\";\n\nimport $ from 'jquery';\n\nconst SEL_NS = \"annotip-text\";\n\n/*\n * IsAnnotator determines if the provided element is part of Annotator. Useful\n * for ignoring mouse actions on the annotator elements.\n * \n * @param element - An Element or TextNode to check.\n * \n * Returns true if the element is a child of an annotator element.\n */\nfunction isAnnotator(element) {\n    const elAndParents = $(element).parents().\n    addBack();\n\n    return elAndParents.filter('[class^=annotator-]').length !== 0;\n}\n\n\n/*\n * TextSelector monitors a document (or a specific element) for text selections\n * and can notify another object of a selection event\n */\nfunction TextSelection(element, options) {\n    this.element = element;\n    this.options = $.extend(true, {}, TextSelection.options, options);\n    this.onSelection = this.options.onSelection;\n\n    if (typeof this.element.ownerDocument !== 'undefined' &&\n        this.element.ownerDocument !== null) {\n        this.document = this.element.ownerDocument;\n\n        $(this.document.body).\n        on(`mouseup.${SEL_NS}`, (e) => {\n            this._checkForEndSelection(e);\n        });\n    } else {\n        console.warn(\"You created an instance of the TextSelector on an \" +\n            \"element that doesn't have an ownerDocument. This won't \" +\n            \"work! Please ensure the element is added to the DOM \" +\n            \"before the plugin is configured:\", this.element);\n    }\n}\n\nTextSelection.prototype.destroy = function () {\n    if (this.document) {\n        $(this.document.body).off(`.${SEL_NS}`);\n    }\n};\n\n/*\n * Public: capture the current selection from the document, excluding any nodes\n * that fall outside of the adder's `element`.\n * \n * Returns an Array of NormalizedRange instances.\n */\nTextSelection.prototype.captureDocumentSelection = function () {\n    let i = 0,\n        len = 0;\n    const ranges = [],\n        rangesToIgnore = [],\n        selection = window.getSelection();\n\n    if (selection.isCollapsed) {\n        return [];\n    }\n\n    for (i = 0; i < selection.rangeCount; i++) {\n        const r = selection.getRangeAt(i),\n            browserRange = r, // new xpathRange.Range.BrowserRange(r),\n            normedRange = browserRange.normalize().limit(this.element);\n\n        /*\n         * If the new range falls fully outside our this.element, we should\n         * add it back to the document but not return it from this method.\n         */\n        if (normedRange === null) {\n            rangesToIgnore.push(r);\n        } else {\n            ranges.push(normedRange);\n        }\n    }\n\n    /*\n     * BrowserRange#normalize() modifies the DOM structure and deselects the\n     * underlying text as a result. So here we remove the selected ranges and\n     * reapply the new ones.\n     */\n    selection.removeAllRanges();\n\n    for (i = 0, len = rangesToIgnore.length; i < len; i++) {\n        selection.addRange(rangesToIgnore[i]);\n    }\n\n    // Add normed ranges back to the selection\n    for (i = 0, len = ranges.length; i < len; i++) {\n        const range = ranges[i],\n            drange = this.document.createRange();\n\n        drange.setStartBefore(range.start);\n        drange.setEndAfter(range.end);\n        selection.addRange(drange);\n    }\n\n\n    return ranges;\n};\n\n/*\n * Event callback: called when the mouse button is released. Checks to see if a\n * selection has been made and if so displays the adder.\n * \n * event - A mouseup Event object.\n * \n * Returns nothing.\n */\nTextSelection.prototype._checkForEndSelection = function (event) {\n    const _nullSelection = () => {\n        if (typeof this.onSelection === 'function') {\n            this.onSelection([], event);\n        }\n    };\n\n    // Get the currently selected ranges.\n    const selectedRanges = this.captureDocumentSelection();\n\n    if (selectedRanges.length === 0) {\n        _nullSelection();\n\n        return;\n    }\n\n    // Don't show the adder if the selection was of a part of Annotator itself.\n    for (let i = 0, len = selectedRanges.length; i < len; i++) {\n        let container = selectedRanges[i].commonAncestor;\n\n        if ($(container).hasClass('annotator-hl')) {\n            container = $(container).parents('[class!=annotator-hl]')[0];\n        }\n        if (isAnnotator(container)) {\n            _nullSelection();\n\n            return;\n        }\n    }\n\n    if (typeof this.onSelection === 'function') {\n        this.onSelection(selectedRanges, event);\n    }\n};\n\n\n// Configuration options\nTextSelection.options = {\n    /*\n     * Callback, called when the user makes a selection.\n     * Receives the list of selected ranges (may be empty) and  the DOM Event\n     * that was detected as a selection.\n     */\n    onSelection: null\n};\n\nexport default TextSelection;\n","\"use strict\";\n\nimport $ from 'jquery';\nimport tippy from 'tippy.js';\nimport TextSelection  from './TextSelection';\n\nconst NS_ANNO = 'annotip-main';\nconst DEF_SETTINGS = {\n\tsubject: null,\n\ttextSelection: true,\n\telementSelection: true,\n\ttippySettings: {\n\n\t},\n\t// Handlers\n\textractContext: null,  // (el$, subject) => null,\n\tprepareUI: null,       // (el$, context) => null,\n\tstoreAnno: null,       // (el$, context, info) => null,\n\tapplyAnno: null        // (el$, anno) => null\n};\n\n\n/**\n * Initialize the annotation engine\n * @param {Object} settings Custom settings for the annotation engine. Refer \n */\nfunction AnnoTip(settings) {\n\tthis.settings = $.extend(true, {}, DEF_SETTINGS, settings);\n\tthis.textSel = new TextSelection();\n\tthis.tp = new tippy();\n}\n\n/**\n * Attach handlers - both element\n */\nAnnoTip.prototype.attach = function (selector) {\n\t// TODO: List selected elements and attach the designated selectors to them.\n\t$(selector).val(NS_ANNO);\n};\n\n/**\n * \n */\nAnnoTip.prototype.applyAnnos = function (annos) {\n\tannos.test = \"\";\n};\n\n/**\n * \n */\nAnnoTip.prototype.detach = function (selector) {\n\t$(selector).val(\"\");\n};\n\n/**\n *  \n */\nAnnoTip.prototype.onTrigger = function () {\n\n};\n\n/**\n * \n */\nAnnoTip.prototype.showUI = function(el$) {\n\tel$.val(\"\");\n};\n/**\n * \n */\nAnnoTip.prototype.hideUI = function() {\n\n};\n\nexport default AnnoTip;\n"],"names":["SEL_NS","isAnnotator","element","elAndParents","$","parents","addBack","filter","length","TextSelection","options","extend","onSelection","ownerDocument","document","body","on","e","_checkForEndSelection","console","warn","prototype","destroy","off","captureDocumentSelection","i","len","ranges","rangesToIgnore","selection","window","getSelection","isCollapsed","rangeCount","r","getRangeAt","browserRange","normedRange","normalize","limit","push","removeAllRanges","addRange","range","drange","createRange","setStartBefore","start","setEndAfter","end","event","_nullSelection","selectedRanges","container","commonAncestor","hasClass","NS_ANNO","DEF_SETTINGS","subject","textSelection","elementSelection","tippySettings","extractContext","prepareUI","storeAnno","applyAnno","AnnoTip","settings","textSel","tp","tippy","attach","selector","val","applyAnnos","annos","test","detach","onTrigger","showUI","el$","hideUI"],"mappings":"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"}