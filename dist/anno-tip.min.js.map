{"version":3,"file":"anno-tip.min.js.map","sources":["../src/TextSelection.js","../src/AnnoTip.js"],"sourcesContent":["\"use strict\";\n\nimport $ from 'jquery';\n\nconst SEL_NS = \"annotip-text\";\n\n/*\n * IsAnnotator determines if the provided element is part of Annotator. Useful\n * for ignoring mouse actions on the annotator elements.\n * \n * @param element - An Element or TextNode to check.\n * \n * Returns true if the element is a child of an annotator element.\n */\nfunction isAnnotator(element) {\n    const elAndParents = $(element).parents().\n    addBack();\n\n    return elAndParents.filter('[class^=annotator-]').length !== 0;\n}\n\n\n/*\n * TextSelector monitors a document (or a specific element) for text selections\n * and can notify another object of a selection event\n */\nfunction TextSelection(element, options) {\n    this.element = element;\n    this.options = $.extend(true, {}, TextSelection.options, options);\n    this.onSelection = this.options.onSelection;\n\n    if (typeof this.element.ownerDocument !== 'undefined' &&\n        this.element.ownerDocument !== null) {\n        this.document = this.element.ownerDocument;\n\n        $(this.document.body).\n        on(`mouseup.${SEL_NS}`, (e) => {\n            this._checkForEndSelection(e);\n        });\n    } else {\n        console.warn(\"You created an instance of the TextSelector on an \" +\n            \"element that doesn't have an ownerDocument. This won't \" +\n            \"work! Please ensure the element is added to the DOM \" +\n            \"before the plugin is configured:\", this.element);\n    }\n}\n\nTextSelection.prototype.destroy = function () {\n    if (this.document) {\n        $(this.document.body).off(`.${SEL_NS}`);\n    }\n};\n\n/*\n * Public: capture the current selection from the document, excluding any nodes\n * that fall outside of the adder's `element`.\n * \n * Returns an Array of NormalizedRange instances.\n */\nTextSelection.prototype.captureDocumentSelection = function () {\n    let i = 0,\n        len = 0;\n    const ranges = [],\n        rangesToIgnore = [],\n        selection = window.getSelection();\n\n    if (selection.isCollapsed) {\n        return [];\n    }\n\n    for (i = 0; i < selection.rangeCount; i++) {\n        const r = selection.getRangeAt(i),\n            browserRange = r, // new xpathRange.Range.BrowserRange(r),\n            normedRange = browserRange.normalize().limit(this.element);\n\n        /*\n         * If the new range falls fully outside our this.element, we should\n         * add it back to the document but not return it from this method.\n         */\n        if (normedRange === null) {\n            rangesToIgnore.push(r);\n        } else {\n            ranges.push(normedRange);\n        }\n    }\n\n    /*\n     * BrowserRange#normalize() modifies the DOM structure and deselects the\n     * underlying text as a result. So here we remove the selected ranges and\n     * reapply the new ones.\n     */\n    selection.removeAllRanges();\n\n    for (i = 0, len = rangesToIgnore.length; i < len; i++) {\n        selection.addRange(rangesToIgnore[i]);\n    }\n\n    // Add normed ranges back to the selection\n    for (i = 0, len = ranges.length; i < len; i++) {\n        const range = ranges[i],\n            drange = this.document.createRange();\n\n        drange.setStartBefore(range.start);\n        drange.setEndAfter(range.end);\n        selection.addRange(drange);\n    }\n\n\n    return ranges;\n};\n\n/*\n * Event callback: called when the mouse button is released. Checks to see if a\n * selection has been made and if so displays the adder.\n * \n * event - A mouseup Event object.\n * \n * Returns nothing.\n */\nTextSelection.prototype._checkForEndSelection = function (event) {\n    const _nullSelection = () => {\n        if (typeof this.onSelection === 'function') {\n            this.onSelection([], event);\n        }\n    };\n\n    // Get the currently selected ranges.\n    const selectedRanges = this.captureDocumentSelection();\n\n    if (selectedRanges.length === 0) {\n        _nullSelection();\n\n        return;\n    }\n\n    // Don't show the adder if the selection was of a part of Annotator itself.\n    for (let i = 0, len = selectedRanges.length; i < len; i++) {\n        let container = selectedRanges[i].commonAncestor;\n\n        if ($(container).hasClass('annotator-hl')) {\n            container = $(container).parents('[class!=annotator-hl]')[0];\n        }\n        if (isAnnotator(container)) {\n            _nullSelection();\n\n            return;\n        }\n    }\n\n    if (typeof this.onSelection === 'function') {\n        this.onSelection(selectedRanges, event);\n    }\n};\n\n\n// Configuration options\nTextSelection.options = {\n    /*\n     * Callback, called when the user makes a selection.\n     * Receives the list of selected ranges (may be empty) and  the DOM Event\n     * that was detected as a selection.\n     */\n    onSelection: null\n};\n\nexport default TextSelection;\n","\"use strict\";\n\nimport $ from 'jquery';\nimport tippy from 'tippy.js';\nimport TextSelection  from './TextSelection';\n\nconst NS_ANNO = 'annotip-main';\nconst DEF_SETTINGS = {\n\tsubject: null,\n\ttextSelection: true,\n\telementSelection: true,\n\ttippySettings: {\n\n\t},\n\t// Handlers\n\textractContext: null,  // (el$, subject) => null,\n\tprepareUI: null,       // (el$, context) => null,\n\tstoreAnno: null,       // (el$, context, info) => null,\n\tapplyAnno: null        // (el$, anno) => null\n};\n\n\n/**\n * Initialize the annotation engine\n * @param {Object} settings Custom settings for the annotation engine. Refer \n */\nfunction AnnoTip(settings) {\n\tthis.settings = $.extend(true, {}, DEF_SETTINGS, settings);\n\tthis.textSel = new TextSelection();\n\tthis.tp = new tippy();\n}\n\n/**\n * Attach handlers - both element\n */\nAnnoTip.prototype.attach = function (selector) {\n\t// TODO: List selected elements and attach the designated selectors to them.\n\t$(selector).val(NS_ANNO);\n};\n\n/**\n * \n */\nAnnoTip.prototype.applyAnnos = function (annos) {\n\tannos.test = \"\";\n};\n\n/**\n * \n */\nAnnoTip.prototype.detach = function (selector) {\n\t$(selector).val(\"\");\n};\n\n/**\n *  \n */\nAnnoTip.prototype.onTrigger = function () {\n\n};\n\n/**\n * \n */\nAnnoTip.prototype.showUI = function(el$) {\n\tel$.val(\"\");\n};\n/**\n * \n */\nAnnoTip.prototype.hideUI = function() {\n\n};\n\nexport default AnnoTip;\n"],"names":["TextSelection","element","options","$","extend","onSelection","this","ownerDocument","document","body","on","e","_this","_checkForEndSelection","console","warn","prototype","destroy","off","captureDocumentSelection","i","len","ranges","rangesToIgnore","selection","window","getSelection","isCollapsed","rangeCount","r","getRangeAt","normedRange","normalize","limit","push","removeAllRanges","length","addRange","range","drange","createRange","setStartBefore","start","setEndAfter","end","event","_nullSelection","_this2","selectedRanges","container","commonAncestor","hasClass","parents","addBack","filter","DEF_SETTINGS","subject","textSelection","elementSelection","tippySettings","extractContext","prepareUI","storeAnno","applyAnno","AnnoTip","settings","textSel","tp","tippy","attach","selector","val","applyAnnos","annos","test","detach","onTrigger","showUI","el$","hideUI"],"mappings":"6KA0BA,SAASA,EAAcC,EAASC,mBACvBD,QAAUA,OACVC,QAAUC,EAAEC,QAAO,EAAM,GAAIJ,EAAcE,QAASA,QACpDG,YAAcC,KAAKJ,QAAQG,iBAEU,IAA/BC,KAAKL,QAAQM,eACW,OAA/BD,KAAKL,QAAQM,oBACRC,SAAWF,KAAKL,QAAQM,cAE7BJ,EAAEG,KAAKE,SAASC,MAChBC,qBAhCO,iBAgCiB,SAACC,GACrBC,EAAKC,sBAAsBF,OAG/BG,QAAQC,KAAK,gMAG2BT,KAAKL,SAIrDD,EAAcgB,UAAUC,QAAU,WAC1BX,KAAKE,UACLL,EAAEG,KAAKE,SAASC,MAAMS,eA7Cf,kBAuDflB,EAAcgB,UAAUG,yBAA2B,eAC3CC,EAAI,EACJC,EAAM,EACJC,EAAS,GACXC,EAAiB,GACjBC,EAAYC,OAAOC,kBAEnBF,EAAUG,kBACH,OAGNP,EAAI,EAAGA,EAAII,EAAUI,WAAYR,IAAK,KACjCS,EAAIL,EAAUM,WAAWV,GAE3BW,EADeF,EACYG,YAAYC,MAAM3B,KAAKL,SAMlC,OAAhB8B,EACAR,EAAeW,KAAKL,GAEpBP,EAAOY,KAAKH,OASpBP,EAAUW,kBAELf,EAAI,EAAGC,EAAME,EAAea,OAAQhB,EAAIC,EAAKD,IAC9CI,EAAUa,SAASd,EAAeH,QAIjCA,EAAI,EAAGC,EAAMC,EAAOc,OAAQhB,EAAIC,EAAKD,IAAK,KACrCkB,EAAQhB,EAAOF,GACjBmB,EAASjC,KAAKE,SAASgC,cAE3BD,EAAOE,eAAeH,EAAMI,OAC5BH,EAAOI,YAAYL,EAAMM,KACzBpB,EAAUa,SAASE,UAIhBjB,GAWXtB,EAAcgB,UAAUH,sBAAwB,SAAUgC,cAChDC,EAAiB,WACa,mBAArBC,EAAK1C,aACZ0C,EAAK1C,YAAY,GAAIwC,IAKvBG,EAAiB1C,KAAKa,8BAEE,IAA1B6B,EAAeZ,YAOd,IAAIhB,EAAI,EAAGC,EAAM2B,EAAeZ,OAAQhB,EAAIC,EAAKD,IAAK,KACnD6B,EAAYD,EAAe5B,GAAG8B,kBAE9B/C,EAAE8C,GAAWE,SAAS,kBACtBF,EAAY9C,EAAE8C,GAAWG,QAAQ,yBAAyB,IA1HL,IAHxCjD,EA+HD8C,GA/HYG,UAChCC,UAEoBC,OAAO,uBAAuBlB,mBA6H1CU,IAMwB,mBAArBxC,KAAKD,kBACPA,YAAY2C,EAAgBH,QApBjCC,KA0BR9C,EAAcE,QAAU,CAMpBG,YAAa,MC5JjB,IACMkD,EAAe,CACpBC,QAAS,KACTC,eAAe,EACfC,kBAAkB,EAClBC,cAAe,GAIfC,eAAgB,KAChBC,UAAW,KACXC,UAAW,KACXC,UAAW,MAQZ,SAASC,EAAQC,QACXA,SAAW9D,EAAEC,QAAO,EAAM,GAAImD,EAAcU,QAC5CC,QAAU,IAAIlE,OACdmE,GAAK,IAAIC,SAMfJ,EAAQhD,UAAUqD,OAAS,SAAUC,GAEpCnE,EAAEmE,GAAUC,IA/BG,iBAqChBP,EAAQhD,UAAUwD,WAAa,SAAUC,GACxCA,EAAMC,KAAO,IAMdV,EAAQhD,UAAU2D,OAAS,SAAUL,GACpCnE,EAAEmE,GAAUC,IAAI,KAMjBP,EAAQhD,UAAU4D,UAAY,aAO9BZ,EAAQhD,UAAU6D,OAAS,SAASC,GACnCA,EAAIP,IAAI,KAKTP,EAAQhD,UAAU+D,OAAS"}