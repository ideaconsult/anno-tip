var AnnoTip=function(t,n){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;function e(t){if(t.startContainer==t.endContainer&&t.startOffset>t.endOffset){var n=t.startOffset;t.setStartOffset(t.endOffset),t.setEndOffset(n)}return t}function o(t,n,e){this.content=t,this.event=n,this.range=function(t){if(0==t.length)return null;if(1==t.length)return t[0];var n=t[t.length-1],e=document.createRange();return e.setStart(t[0].startContainer,t[0].startOffset),e.setEnd(n.endContainer,n.endOffset),e}(e)}function i(n,e){var o=this;if(this.element=n,this.settings=t.extend(!0,{},i.defaults,e),!this.element.ownerDocument)throw new Error("Non-attached element used for text selection: ".concat(n));this.document=this.element.ownerDocument,t(this.document.body).on("mouseup.annotip-text",(function(t){return o._handleSelection(t)}))}o.prototype.getElement=function(){var t=this.range.commonAncestorContainer;return t instanceof Element?t:t.parentElement},o.prototype.getBoundingRect=function(){return this.range.getBoundingClientRect()},i.prototype.detach=function(){this.document&&t(this.document.body).off(".annotip-text")},i.prototype._handleSelection=function(n){var i=this.document.getSelection();if(!i.isCollapsed){for(var s,r,a=[],c=0;c<i.rangeCount;++c){var l=i.getRangeAt(c);t.contains(this.element,l.commonAncestorContainer)&&(!this.multipleNodes&&0!=a.length&&(s=a[0],r=l,t.unique([s.startContainer,s.endContainer,r.startContainer,r.endContainer]).length>0)||a.push(e(l)))}a.length>0&&this.settings.onSelection(new o(i.toString(),n,a))}},i.defaults={multipleNodes:!1,onSelection:null};function s(t,n){for(var e in n)n.hasOwnProperty(e)&&(t=t.replace("{{".concat(e,"}}"),n[e]));return t}function r(e){this.settings=t.extend(!0,{},r.defaults,e),"string"==typeof this.settings.textSelection&&(this.settings.textSelection=this.settings.textSelection.toLowerCase()),n.setDefaultProps(this.settings.tippySettings),this.selections=[],this.tp=null}return r.prototype.attach=function(n){var e=this;t(n).each((function(t,n){if(!n.ownerDocument)throw new Error("Non-attached element used for anno-tip: ".concat(n));e.settings.textSelection&&"none"!==e.settings.textSelection&&e.selections.push(new i(n,{multipleNodes:"multi"===e.settings.textSelection,onSelection:function(t,n,o){return e._handleSelection(t,n,o)}}))}))},r.prototype.applyAnnos=function(t){t.test=""},r.prototype.discard=function(){this.tp.destroy(),this.tp=null},r.prototype.detach=function(){null!=this.tp&&this.tp.destroy()},r.prototype._getTippyBox=function(){return t("[class=tippy-box]")},r.prototype._handleSelection=function(e){var o=this,i={selection:e.content,range:e.range,event:e.event};null==this.tp&&!1!==this._call("onSelection",i)&&(null!=this.tp&&this.tp.destroy(),this.tp=new n(e.getElement(),{content:s('\n<div class="annotip-frame">\n\t<div class="annotip-dlg" style="display: none">{{content}}</div>\n\t<div class="annotip-actions">{{actions}}</div>\n</div>',{actions:i.actionsHtml||this.settings.actionsHtml,content:i.content||i.selection}),appendTo:document.body,onShown:function(){var n=o._getTippyBox();i.element=n[0],n.on("click.annotip-main","div.annotip-actions button",(function(n){o._call("onAction",t(n.currentTarget).data("annotipAction"),i,n)}))},onClickOutside:function(t){return t.destroy()},onHide:function(){return!1!==o._call("onClose",i)},onDestroy:function(){o.tp=null},getReferenceClientRect:function(){return e.getBoundingRect()}}))},r.prototype._call=function(t){"string"==typeof t&&(t=this.settings[t]);for(var n=arguments.length,e=new Array(n>1?n-1:0),o=1;o<n;o++)e[o-1]=arguments[o];return"function"==typeof t?t.apply(this,e):void 0},r.defaults={subject:null,textSelection:!0,elementSelection:!0,actionsHtml:'\n\t<button data-annotip-action="cancel">Cancel</button>\n\t<button data-annotip-action="ok">OK</button>\n',tippySettings:{placement:"auto",hideOnClick:!1,trigger:"manual",allowHTML:!0,interactive:!0,showOnCreate:!0},onSelection:null,onAction:null,onClose:null},r}($,tippy);
//# sourceMappingURL=anno-tip.min.js.map
